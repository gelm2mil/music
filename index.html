<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>:: by--gelm::</title>

<style>
:root{
  --green: #00ff22;
  --blue: #00eaff;
  --red: #ff0033;
  --violet: #b300ff;
  --player-width:980px;
  --pulse: 1;
}

*{box-sizing:border-box}

/* FONDO GLOBAL FULL NEÓN (Opción C) */
html,body{
  height:100%;
  margin:0;
  font-family:"Verdana",Arial,sans-serif;
}

body{
  color:#ffffff;
  text-align:center;
  margin:0;
  padding:0;
  background:
    radial-gradient(circle at 0% 0%, #ff3bff 0%, transparent 40%),
    radial-gradient(circle at 100% 0%, #00eaff 0%, transparent 40%),
    radial-gradient(circle at 50% 100%, #7b00ff 0%, transparent 48%),
    #02000c;
  background-size:140% 140%;
  animation:bgMove 16s ease-in-out infinite alternate;
}

/* movimiento suave del fondo */
@keyframes bgMove{
  0%{
    background-position:0% 0%, 100% 0%, 50% 100%, 50% 50%;
  }
  50%{
    background-position:10% 30%, 90% 10%, 40% 90%, 50% 40%;
  }
  100%{
    background-position:20% 40%, 80% 0%, 60% 100%, 50% 60%;
  }
}

/* CAPA DE ONDAS NEÓN (suave, encima del fondo) */
.page-wrap{
  min-height:100vh;
  padding:40px 16px 40px;
  display:flex;
  flex-direction:column;
  align-items:center;
  position:relative;
}
.page-wrap::before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(
      -8deg,
      rgba(0,255,255,0.05) 0px,
      rgba(0,255,255,0.08) 2px,
      transparent 3px,
      transparent 6px
    );
  mix-blend-mode:screen;
  opacity:0.35;
  animation:waves 20s linear infinite;
  z-index:0;
}
@keyframes waves{
  0%{transform:translateX(0);}
  100%{transform:translateX(-160px);}
}

/* MARCO CENTRAL CON DOBLE NEÓN (Opción C) */
.center{
  position:relative;
  width:100%;
  max-width:var(--player-width);
  margin:0 auto;
  background:rgba(0,0,0,0.85);
  border-radius:26px;
  padding:26px 24px 30px;
  border:3px solid #00ffe6;
  box-shadow:
    0 0 40px rgba(0,255,230,0.9),
    0 0 120px rgba(148,0,255,0.8),
    0 35px 60px rgba(0,0,0,0.9);
  overflow:hidden;
  z-index:1;
}
.center::before,
.center::after{
  content:"";
  position:absolute;
  inset:10px;
  border-radius:20px;
  pointer-events:none;
}
.center::before{
  border:2px solid rgba(0,255,230,0.32);
  box-shadow:
    0 0 30px rgba(0,255,230,0.6),
    0 0 60px rgba(0,196,255,0.4);
}
.center::after{
  border:2px solid transparent;
  background:
    linear-gradient(90deg,#ff3bff,#00eaff,#7bff84,#ffcc33,#ff3bff);
  mix-blend-mode:screen;
  opacity:0.22;
  filter:blur(3px);
  animation:borderFlow 14s linear infinite;
}
@keyframes borderFlow{
  0%{transform:translateX(-12px);}
  100%{transform:translateX(12px);}
}

/* CABECERA CON ICONOS REDONDOS NEÓN */
.header{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:22px;
  margin-bottom:18px;
  position:relative;
  z-index:2;
}

.header-title{
  color:#f07bff; /* violeta neón */
  font-weight:900;
  font-size:20px;
  text-transform:uppercase;
  letter-spacing:5px;
  text-shadow:
    0 0 8px rgba(240,123,255,1),
    0 0 20px rgba(180,80,255,0.9),
    0 0 34px rgba(120,40,255,0.9);
}

.icon-btn{
  width:52px;
  height:52px;
  border-radius:50%;
  border:2px solid #00ffe6;
  background:
    radial-gradient(circle at 30% 0%,
              #00ffe6 0%,
              #00a4ff 40%,
              #001a33 100%);
  color:#ffffff;
  cursor:pointer;
  box-shadow:
    0 0 20px rgba(0,255,230,0.9),
    0 0 32px rgba(0,164,255,0.8);
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform .12s ease-out, box-shadow .12s ease-out;
}
.icon-btn:hover{
  transform:translateY(-1px) scale(1.07);
  box-shadow:
    0 0 28px rgba(0,255,230,1),
    0 0 46px rgba(0,164,255,0.95);
}
.icon-btn:active{
  transform:translateY(1px) scale(0.96);
}
.header-icon-img{
  width:34px;
  height:34px;
  border-radius:50%;
}

/* MARCO ECU / VISUALIZADOR */
.eq-frame{
  width:100%;
  padding:16px;
  border-radius:22px;
  margin:8px auto 18px;
  position:relative;
  z-index:2;
  background:radial-gradient(circle at 0% 0%,rgba(255,65,150,0.3) 0%,rgba(0,0,0,0.9) 45%,rgba(0,0,0,1) 100%);
  box-shadow:
    0 0 40px rgba(255,65,150,0.55),
    0 0 70px rgba(0,214,255,0.35);
}
.eq-frame::before{
  content:"";
  position:absolute;
  inset:4px;
  border-radius:18px;
  border:3px solid transparent;
  background:
    linear-gradient(90deg,#ff3b5f,#ffcc33,#7b5bff,#00eaff,#00ff8b,#ff3b5f);
  mix-blend-mode:screen;
  opacity:0.7;
}

/* canvas por encima */
#viz{
  position:relative;
  display:block;
  width:100%;
  height:230px;
  background:transparent;
  border-radius:18px;
  z-index:1;
}

/* AUDIO */
.audio-wrap{
  margin:18px 0 8px;
  display:flex;
  justify-content:center;
  position:relative;
  z-index:2;
}
.player-surface{
  background:radial-gradient(circle at 50% 0%,rgba(0,255,200,0.35),rgba(0,0,0,0.96));
  border-radius:26px;
  padding:16px 28px;
  display:inline-block;
  box-shadow:
    0 8px 30px rgba(0,0,0,0.9),
    0 0 24px rgba(0,255,200,0.65);
  border:2px solid rgba(0,255,230,0.95);
  cursor:pointer;
}
audio{
  background:transparent;
  color:#fff;
  width:760px;
  max-width:86vw;
  height:44px;
  border-radius:12px;
  outline:none;
}

/* barra nativa casi transparente + verde neón */
audio::-webkit-media-controls-enclosure{
  background-color: transparent;
}
audio::-webkit-media-controls-panel{
  background: rgba(0,0,0,0.25);
}
audio::-webkit-media-controls-timeline{
  background-color: rgba(0,255,120,0.7);
  border-radius:999px;
}
audio::-webkit-media-controls-play-button,
audio::-webkit-media-controls-mute-button{
  filter:grayscale(0) brightness(1.4) contrast(1.2);
}

/* TIEMPO + BARRA PROGRESO PERSONALIZADA */
.time{
  text-align:center;
  color:#00ffbf;
  font-family:monospace;
  margin-top:8px;
  font-size:13px;
  text-shadow:0 0 6px rgba(0,255,191,0.4);
  position:relative;
  z-index:2;
}
.progress-wrap{
  width:80%;
  height:12px;
  background:rgba(0,0,0,0.8);
  margin:14px auto;
  border-radius:999px;
  border:2px solid rgba(255,255,255,0.04);
  overflow:hidden;
  position:relative;
  z-index:2;
  box-shadow:
    0 0 16px rgba(0,0,0,0.9),
    0 0 26px rgba(0,255,200,0.48);
}
.progress{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ff6a,#00ffe6,#00c8ff,#b15bff,#ff3bff);
  background-size:300% 100%;
  transition:width .1s linear;
}

/* BOTONES */
.controls-row{
  display:flex;
  gap:12px;
  justify-content:center;
  align-items:center;
  margin-bottom:6px;
  margin-top:10px;
  position:relative;
  z-index:2;
}

.btn{
  background: radial-gradient(circle at top,
              #00ffe6 0%,
              #00a4ff 45%,
              #00264d 100%);
  border:none;
  color:#000;
  padding:8px 14px;
  border-radius:22px;
  cursor:pointer;
  font-weight:700;
  font-size:13px;
  text-shadow:0 0 4px rgba(255,255,255,0.5);
  box-shadow:
    0 0 14px rgba(0,255,230,0.9),
    0 0 26px rgba(0,164,255,0.8);
  transition:transform .12s ease-out, box-shadow .12s ease-out;
}
.btn:hover{
  transform:translateY(-1px) scale(1.04);
  box-shadow:
    0 0 20px rgba(0,255,230,1),
    0 0 40px rgba(0,164,255,0.95);
}
.btn:active{
  transform:translateY(1px) scale(0.98);
}

/* SELECTOR CANCIONES NEÓN */
.song-select{
  display:block;
  margin:18px auto 18px;
  width:60%;
  min-width:260px;
  height:36px;
  background:#000;
  color:#00ffbf;
  padding:6px 8px;
  border-radius:10px;
  border:2px solid #00ffe6;
  font-family:Verdana,monospace;
  font-size:14px;
  box-shadow:0 0 16px rgba(0,255,230,0.55);
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  position:relative;
  z-index:2;
}
.song-select option{
  background:#000000;
  color:#00ffbf;
}

/* FRASE INFERIOR PLAY/PAUSE */
.phrase-wrapper{
  width:100%;
  display:flex;
  justify-content:center;
  margin-top:28px;
  margin-bottom:26px;
  position:relative;
  z-index:2;
}
.phrase-box{
  width:72%;
  min-width:320px;
  background:radial-gradient(circle at 20% 0%,
           rgba(0,80,255,0.45) 0%,
           rgba(0,0,0,0.96) 45%,
           rgba(0,0,0,1) 100%);
  padding:26px;
  border-radius:22px;
  color:#ffffff;
  font-size:30px;
  font-weight:800;
  letter-spacing:6px;
  text-align:center;
  border:3px solid rgba(0,255,230,0.9);
  box-shadow:
    0 10px 30px rgba(0,0,0,0.9),
    0 0 40px rgba(0,255,230, calc(0.28 * var(--pulse)));
  transition: box-shadow .12s linear,
              transform .12s linear,
              text-shadow .12s linear,
              border-color .12s linear,
              color .12s linear,
              background .18s linear;
  cursor:pointer;
  user-select:none;
}

.phrase-box.paused{
  color:#39c6ff;
  border-color:#00ffe6;
  text-shadow:
    0 0 12px rgba(0,190,255,1),
    0 0 26px rgba(0,255,255,0.9),
    0 0 40px rgba(0,140,255,1);
}

.phrase-box.playing{
  color:#aee7ff;
  border-color:#00cfff;
  background:radial-gradient(circle at 10% 0%,
           rgba(0,200,255,0.75) 0%,
           rgba(0,0,0,0.96) 45%,
           rgba(0,0,0,1) 100%);
  text-shadow:
    0 0 16px rgba(0,220,255,1),
    0 0 34px rgba(0,140,255,1),
    0 0 50px rgba(0,255,210,0.95);
}

.phrase-sub{
  margin-top:12px;
  color:#00ff22;
  font-size:14px;
  text-shadow:0 0 6px rgba(0,255,34,0.6);
}

/* PIE */
.footer{
  margin-top:4px;
  color:#00ff22;
  text-align:center;
  font-size:12px;
  text-shadow:0 0 6px rgba(0,255,34,0.4);
  position:relative;
  z-index:2;
}

/* RESPONSIVE */
@media (max-width:900px){
  :root{--player-width:95vw;}
  #viz{height:170px;}
  .phrase-box{
    font-size:20px;
    letter-spacing:4px;
    padding:16px;
    width:86%;
  }
  audio{height:40px;}
  .song-select{width:86%;}
  .page-wrap{padding:24px 10px 30px;}
}
</style>
</head>

<body>
<div class="page-wrap">
  <div class="center">
    <!-- CABECERA CON ICONOS -->
    <div class="header">
      <button id="headerPrev" class="icon-btn" aria-label="Anterior">
        <img src="icons/icon-192.png" alt="NEROX" class="header-icon-img">
      </button>
      <div class="header-title">MÚSICA VARIADA</div>
      <button id="headerNext" class="icon-btn" aria-label="Siguiente">
        <img src="icons/icon-512.png" alt="GELM" class="header-icon-img">
      </button>
    </div>

    <div class="eq-frame">
      <canvas id="viz"></canvas>
    </div>

    <div class="audio-wrap">
      <div class="player-surface" id="playerSurface">
        <audio id="audio" controls crossorigin="anonymous"></audio>
      </div>
    </div>

    <div class="controls-row">
      <button id="prev" class="btn">⏮ Anterior</button>
      <button id="playPause" class="btn">▶ / ⏸</button>
      <button id="next" class="btn">Siguiente ⏭</button>
      <button id="shuffleBtn" class="btn">Shuffle: ON</button>
    </div>

    <div class="time" id="timeText">00:00 / 00:00</div>

    <div class="progress-wrap">
      <div id="progress" class="progress"></div>
    </div>

    <select id="cancion" class="song-select" aria-label="Seleccion de canciones">
      <option value="">[..:: ELIGE LA CANCION ::..]</option>
    </select>

    <div class="phrase-wrapper">
      <div id="phrase" class="phrase-box paused">
        BENDICIDO
        <div class="phrase-sub">DÍA</div>
      </div>
    </div>

    <div class="footer">
      2000 - 2040 | BIENVENIDOS | nerox2mil@proton.me<br>
      att: ---[terry]---
    </div>
  </div>
</div>

<script>
/* Bloqueo clic derecho */
document.addEventListener('contextmenu', e => e.preventDefault());

/* Elementos */
const audio = document.getElementById('audio');
const canvas = document.getElementById('viz');
const ctx = canvas.getContext('2d');
const progressEl = document.getElementById('progress');
const timeText = document.getElementById('timeText');
const select = document.getElementById('cancion');
const phrase = document.getElementById('phrase');
const playerSurface = document.getElementById('playerSurface');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const playPauseBtn = document.getElementById('playPause');
const shuffleBtn = document.getElementById('shuffleBtn');
const headerPrev = document.getElementById('headerPrev');
const headerNext = document.getElementById('headerNext');

let audioCtx = null, analyser = null, sourceNode = null, dataArray = null, bufferLength = 0, vizId = null;
let bars = 96, layers = 6;

/* Playlist */
let playlist = []; // [{url,title},...]
let order = [];    // índices
let currentOrderIndex = 0;
let shuffleOn = true;
let firstInteractionDone = false;

/* Resize canvas */
function resizeCanvas(){
  const r = canvas.getBoundingClientRect();
  canvas.width = Math.floor(r.width * devicePixelRatio);
  canvas.height = Math.floor(r.height * devicePixelRatio);
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* Time formatter */
function fmt(t){
  if(!t || isNaN(t)) return "00:00";
  const m = Math.floor(t/60);
  const s = Math.floor(t%60);
  return String(m).padStart(2,'0')+":"+String(s).padStart(2,'0');
}

/* Progress */
audio.addEventListener('timeupdate', ()=>{
  if(audio.duration && !isNaN(audio.duration)){
    const pct = (audio.currentTime / audio.duration) * 100;
    progressEl.style.width = pct + "%";
    progressEl.style.backgroundPosition = (audio.currentTime * 10 % 300) + "% 0%";
    timeText.textContent = fmt(audio.currentTime) + " / " + fmt(audio.duration);
  } else {
    timeText.textContent = "00:00 / 00:00";
  }
});

/* Seek */
document.querySelector('.progress-wrap').addEventListener('click', function(e){
  if(!audio.duration) return;
  const rect = this.getBoundingClientRect();
  const x = e.clientX - rect.left;
  audio.currentTime = (x / rect.width) * audio.duration;
});

/* helpers de reproducción */
function togglePlay(){
  if(!playlist.length) return;
  if(audio.paused) audio.play().catch(()=>{}); else audio.pause();
}

function firstStartIfNeeded(){
  if(firstInteractionDone) return false;
  firstInteractionDone = true;
  if(!order.length) buildOrderWithStart();
  currentOrderIndex = 0;
  playCurrentOrder();
  return true;
}

/* Botones */
playPauseBtn.addEventListener('click', ()=>{
  if(firstStartIfNeeded()) return;
  togglePlay();
});

prevBtn.addEventListener('click', ()=> prevSong());
nextBtn.addEventListener('click', ()=> nextSong());

headerPrev.addEventListener('click', (e)=>{ e.stopPropagation(); prevSong(); });
headerNext.addEventListener('click', (e)=>{ e.stopPropagation(); nextSong(); });

shuffleBtn.addEventListener('click', ()=>{
  shuffleOn = !shuffleOn;
  shuffleBtn.textContent = shuffleOn ? 'Shuffle: ON' : 'Shuffle: OFF';
  if(playlist.length){
    const currentPlaylistIndex = order[currentOrderIndex] ?? 0;
    buildOrderWithStart(currentPlaylistIndex);
  }
});

/* selector */
select.addEventListener('change', function(){
  if(!this.value) return;
  const idx = parseInt(this.value,10);
  buildOrderWithStart(idx);
  currentOrderIndex = 0;
  firstInteractionDone = true;
  playCurrentOrder();
});

/* teclado */
document.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){
    e.preventDefault();
    if(firstStartIfNeeded()) return;
    togglePlay();
  }
});

/* AudioContext & visualizer */
function createGraph(){
  if(audioCtx) return true;
  try{
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    sourceNode = audioCtx.createMediaElementSource(audio);
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    bufferLength = analyser.frequencyBinCount;
    dataArray = new Uint8Array(bufferLength);
    sourceNode.connect(analyser);
    analyser.connect(audioCtx.destination);
    return true;
  }catch(e){
    console.warn("AudioContext creation failed:", e);
    return false;
  }
}

/* Visualizer draw */
function startViz(){
  if(!analyser) return;
  cancelAnimationFrame(vizId);
  function draw(){
    analyser.getByteFrequencyData(dataArray);
    const rect = canvas.getBoundingClientRect();
    const W = rect.width;
    const H = rect.height;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const gap = 2;
    const barW = Math.max(1, (W / bars) - gap);

    let sum = 0;
    for(let i=0;i<dataArray.length;i++) sum += dataArray[i];
    const avg = sum / dataArray.length / 255;

    document.documentElement.style.setProperty('--pulse', (0.6 + avg*1.4).toFixed(3));

    for(let layer=0; layer<layers; layer++){
      const depth = layer / layers;
      const scale = 1 - depth * 0.5;
      const alpha = 0.18 + (1 - depth) * 0.6;
      const yOffset = layer * (H * 0.02);

      for(let i=0; i<bars; i++){
        const idx = Math.floor(i * bufferLength / bars);
        const v = dataArray[idx] / 255;
        const h = Math.max(2, v * H * 0.78 * scale);
        const x = i * (barW + gap) + layer*4;
        const y = H - h - yOffset;

        const pos = i / bars;
        let color;
        if(pos < 0.2) color = lerpColor([255,40,95],[255,210,60], pos/0.2);
        else if(pos < 0.45) color = lerpColor([255,210,60],[166,77,255], (pos-0.2)/0.25);
        else if(pos < 0.7) color = lerpColor([166,77,255],[0,68,255], (pos-0.45)/0.25);
        else color = lerpColor([0,68,255],[0,255,140], (pos-0.7)/0.3);

        ctx.fillStyle = `rgba(${color[0]},${color[1]},${color[2]},${alpha})`;
        ctx.shadowBlur = 24 * (1 - depth) * (1 + avg*1.6);
        ctx.shadowColor = `rgba(${color[0]},${Math.max(40,color[1])},${color[2]},${0.45*(1-depth)})`;
        ctx.fillRect(x, y, barW*0.82, h);
        ctx.shadowBlur = 0;
      }
    }
    vizId = requestAnimationFrame(draw);
  }
  draw();
}

/* helpers */
function lerpColor(a,b,t){
  return [
    Math.round(a[0] + (b[0]-a[0])*t),
    Math.round(a[1] + (b[1]-a[1])*t),
    Math.round(a[2] + (b[2]-a[2])*t)
  ];
}

/* Flame text effect + vibración frase en azul neón */
(function flameLoop(){
  let pulse = 0;
  function frame(){
    if(analyser && dataArray){
      analyser.getByteFrequencyData(dataArray);
      let sum = 0;
      for(let i=0;i<dataArray.length;i++) sum += dataArray[i];
      let avg = sum / dataArray.length / 255;
      const intensity = 6 + Math.min(72, Math.floor(avg * 140));
      phrase.style.textShadow =
        `0 0 ${intensity}px rgba(60,200,255,0.98),
         0 0 ${intensity*1.4}px rgba(0,150,255,0.7)`;
      phrase.style.transform = `translateY(${Math.min(14,Math.floor(avg*28))}px)`;
      phrase.style.letterSpacing = (6 + Math.round(avg * 6)) + "px";
    } else {
      pulse += 0.03;
      const p = (Math.sin(pulse) + 1) / 2;
      const intensity = 6 + Math.round(12 * p);
      phrase.style.textShadow =
        `0 0 ${intensity}px rgba(60,200,255,0.9),
         0 0 ${intensity*1.3}px rgba(0,150,255,0.7)`;
      phrase.style.transform = `translateY(${Math.round(4 * p)}px)`;
    }
    requestAnimationFrame(frame);
  }
  frame();
})();

/* Start viz on first user play */
let firstPlay = false;
audio.addEventListener('play', async () => {
  if(!firstPlay){
    const ok = createGraph();
    if(ok) startViz();
    document.documentElement.style.setProperty('--pulse', '1.2');
    setTimeout(()=> document.documentElement.style.setProperty('--pulse','1'), 600);
    firstPlay = true;
  }
});

/* playback control using order array */
function playCurrentOrder(){
  if(!order.length) return;
  const playlistIdx = order[currentOrderIndex];
  const item = playlist[playlistIdx];
  if(!item) return;
  audio.src = item.url;
  audio.load();
  audio.play().catch(()=>{});
  select.value = playlistIdx;
}

/* next/prev */
function nextSong(){
  if(!order.length) return;
  currentOrderIndex++;
  if(currentOrderIndex >= order.length){
    buildOrderWithStart();
    currentOrderIndex = 0;
  }
  playCurrentOrder();
}
function prevSong(){
  if(!order.length) return;
  currentOrderIndex--;
  if(currentOrderIndex < 0) currentOrderIndex = order.length - 1;
  playCurrentOrder();
}
audio.addEventListener('ended', ()=> nextSong());

/* Build select UI from playlist */
function buildSelect(){
  select.innerHTML = '<option value="">[..:: ELIGE LA CANCION ::..]</option>';
  playlist.forEach((s,i)=>{
    const o = document.createElement('option');
    o.value = i;
    o.textContent = s.title;
    select.appendChild(o);
  });
}

/* Shuffle helper */
function shuffleArray(a){
  const arr = a.slice();
  for(let i = arr.length -1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

/* build order: optionally force startIndex first (index en playlist) */
function buildOrderWithStart(startIndex){
  if(playlist.length===0) return;

  let forcedStart = (typeof startIndex === 'number') ? startIndex : null;
  if(forcedStart === null){
    const idx = playlist.findIndex(p=> p.title && p.title.toLowerCase().includes('abrazar la niebla'));
    if(idx !== -1) forcedStart = idx;
  }
  if(forcedStart === null) forcedStart = 0;

  const others = [];
  for(let i=0;i<playlist.length;i++) if(i!==forcedStart) others.push(i);
  const orderedOthers = shuffleOn ? shuffleArray(others) : others;
  order = [forcedStart, ...orderedOthers];

  if(typeof startIndex === 'number' && startIndex !== forcedStart){
    const pool = [];
    for(let i=0;i<playlist.length;i++) if(i!==startIndex) pool.push(i);
    const rest = shuffleOn ? shuffleArray(pool) : pool;
    order = [startIndex, ...rest];
  }
  currentOrderIndex = 0;
}

/* Cargar canciones desde canciones.txt en GitHub */
async function loadSongsFromTXT(){
  try{
    const resp = await fetch('canciones.txt?nocache=' + Date.now());
    const text = await resp.text();
    const lines = text.split(/\r?\n/);
    playlist = [];

    for (const line of lines){
      const trimmed = line.trim();
      if(!trimmed || trimmed.startsWith('#')) continue;
      const firstSpace = trimmed.indexOf(' ');
      if(firstSpace === -1) continue;
      const url = trimmed.slice(0, firstSpace).trim();
      const title = trimmed.slice(firstSpace+1).trim();
      if(url && title){
        playlist.push({url, title});
      }
    }

    if(!playlist.length) return;
    buildSelect();
    buildOrderWithStart();
    // la reproducción inicia con el PRIMER toque del usuario
  }catch(e){
    console.error('Error loading canciones.txt', e);
  }
}

/* click en superficie del player = autoplay + play/pause */
playerSurface.addEventListener('click', (e)=>{
  if(e.target.tagName.toLowerCase() === 'audio') return;
  if(firstStartIfNeeded()) return;
  togglePlay();
});

/* Bendicido día = PLAY/PAUSA */
phrase.addEventListener('click', ()=>{
  if(firstStartIfNeeded()) return;
  togglePlay();
});

/* estado visual play/pause */
audio.addEventListener('play', ()=>{
  phrase.classList.add('playing');
  phrase.classList.remove('paused');
  playPauseBtn.textContent = '⏸';
});
audio.addEventListener('pause', ()=>{
  phrase.classList.add('paused');
  phrase.classList.remove('playing');
  playPauseBtn.textContent = '▶';
});

/* Inicializar */
loadSongsFromTXT();
</script>
</body>
</html>
