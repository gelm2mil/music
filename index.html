<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>M√∫sica Variada ‚Äì GELM</title>

<style>
/* ================================
   üé® PALETA NE√ìN OFICIAL GELM 2026
   ================================ */
:root {
    --neon-cyan: #00f6ff;
    --neon-magenta: #ff00ff;
    --neon-purple: #8a00ff;
    --neon-blue: #00ccff;
    --neon-green: #00ff99;
    --neon-yellow: #ffee55;
    --dark-bg: #0d0017;
}

/* Fondo full neon degradado */
body {
    margin: 0;
    padding: 0;
    background: linear-gradient(120deg, #6a00ff, #3d00b8, #001f74);
    background-size: 300% 300%;
    animation: bgMove 20s infinite alternate ease-in-out;
    font-family: "Verdana", sans-serif;
    color: white;
    text-align: center;
}

@keyframes bgMove {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
}

/* Marco central */
#player-box {
    width: 82%;
    margin: 40px auto;
    border: 4px solid var(--neon-cyan);
    border-radius: 25px;
    padding: 25px;
    background: rgba(10, 0, 25, 0.45);
    box-shadow: 0 0 25px var(--neon-cyan), inset 0 0 20px #000;
}

/* T√≠tulos ne√≥n */
.title {
    font-size: 33px;
    letter-spacing: 3px;
    color: var(--neon-magenta);
    text-shadow: 0 0 8px var(--neon-magenta), 0 0 20px var(--neon-magenta);
}

.neon-badge {
    display: inline-block;
    padding: 6px 14px;
    margin: 10px;
    border-radius: 50px;
    background: var(--neon-blue);
    box-shadow: 0 0 15px var(--neon-blue);
    font-weight: bold;
}

/* Visualizador */
#visual {
    width: 90%;
    height: 200px;
    background: #000;
    border-radius: 18px;
    margin: 20px auto;
    box-shadow: 0 0 12px #ff006e, inset 0 0 18px #001;
}

/* Barra progreso */
#progress {
    width: 80%;
    height: 10px;
    margin: 15px auto;
    background: #222;
    border-radius: 20px;
    overflow: hidden;
    cursor: pointer;
}
#progress-fill {
    width: 0%;
    height: 100%;
    background: var(--neon-green);
    box-shadow: 0 0 12px var(--neon-green);
}

/* Botones */
.btn {
    padding: 10px 22px;
    margin: 10px;
    border-radius: 25px;
    border: none;
    background: var(--neon-blue);
    color: #fff;
    font-size: 15px;
    cursor: pointer;
    box-shadow: 0 0 14px var(--neon-blue);
    transition: 0.2s;
}
.btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 22px var(--neon-blue);
}

/* Buscador */
#search {
    width: 60%;
    padding: 10px;
    border: 2px solid var(--neon-cyan);
    border-radius: 20px;
    background: #00000070;
    color: white;
    text-align: center;
    font-size: 16px;
    box-shadow: 0 0 12px var(--neon-cyan);
}

/* Bendecido D√≠a */
#bless-box {
    padding: 25px;
    width: 70%;
    margin: 20px auto;
    border-radius: 20px;
    background: rgba(0, 60, 90, 0.6);
    box-shadow: 0 0 20px var(--neon-blue);
}
#bless {
    font-size: 32px;
    letter-spacing: 7px;
    text-shadow: 0 0 8px white, 0 0 20px var(--neon-blue);
}
#dia {
    font-size: 18px;
    color: var(--neon-green);
    text-shadow: 0 0 8px var(--neon-green);
}

/* Ajustes Mobile */
@media (max-width: 600px) {
    #player-box { width: 95%; padding: 12px; }
    #visual { height: 170px; }
    #search { width: 90%; }
}
</style>
</head>

<body>

<div id="player-box">

    <span class="neon-badge">GELM</span>
    <span class="title">M√öSICA VARIADA</span>
    <span class="neon-badge">GELM</span>

    <!-- Visualizador -->
    <canvas id="visual"></canvas>

    <!-- Audio -->
    <audio id="audio"></audio>

    <!-- Barra progreso -->
    <div id="progress"><div id="progress-fill"></div></div>

    <!-- Botones -->
    <button class="btn" id="prev">‚èÆ Anterior</button>
    <button class="btn" id="playpause">‚èØ</button>
    <button class="btn" id="next">Siguiente ‚è≠</button>
    <button class="btn" id="shuffle">Shuffle: ON</button>

    <!-- Buscador -->
    <br>
    <input id="search" placeholder="buscar canci√≥n..." />

    <!-- Bendecido D√≠a -->
    <div id="bless-box">
        <div id="bless">BENDICIDO</div>
        <div id="dia">D √ç A</div>
    </div>

</div>

<!-- ========================
     üéµ L√ìGICA DEL REPRODUCTOR
     ======================== -->
<script>
let audio = document.getElementById("audio");
let canvas = document.getElementById("visual");
let ctx = canvas.getContext("2d");
let progress = document.getElementById("progress");
let fill = document.getElementById("progress-fill");

let songs = [];
let current = 0;
let isPlaying = false;
let shuffle = true;

/* CARGAR JSON */
fetch("musica.json")
  .then(r => r.json())
  .then(data => {
      songs = data;
      startRandom();
  });

/* Iniciar canci√≥n aleatoria */
function startRandom(){
    current = Math.floor(Math.random() * songs.length);
    loadSong();
}

/* Cargar canci√≥n */
function loadSong(){
    audio.src = songs[current].url;
    audio.play();
    isPlaying = true;
    animate();
}

/* Botones */
document.getElementById("playpause").onclick = ()=>{
    if(isPlaying){ audio.pause(); isPlaying=false; }
    else { audio.play(); isPlaying=true; }
};

document.getElementById("next").onclick = ()=> {
    current = shuffle ? Math.floor(Math.random()*songs.length) : (current+1)%songs.length;
    loadSong();
};

document.getElementById("prev").onclick = ()=> {
    current = current === 0 ? songs.length-1 : current-1;
    loadSong();
};

document.getElementById("shuffle").onclick = ()=>{
    shuffle = !shuffle;
    document.getElementById("shuffle").innerText = "Shuffle: " + (shuffle ? "ON" : "OFF");
};

/* Progreso */
audio.ontimeupdate = ()=> {
    fill.style.width = (audio.currentTime / audio.duration)*100 + "%";
};

/* Visualizaci√≥n */
function animate(){
    let audioCtx = new AudioContext();
    let src = audioCtx.createMediaElementSource(audio);
    let analyser = audioCtx.createAnalyser();

    src.connect(analyser);
    analyser.connect(audioCtx.destination);

    analyser.fftSize = 256;
    let buffer = new Uint8Array(analyser.frequencyBinCount);

    function draw(){
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(buffer);

        ctx.clearRect(0,0,canvas.width,canvas.height);

        let barWidth = canvas.width / buffer.length;
        for(let i=0;i<buffer.length;i++){
            let h = buffer[i];
            ctx.fillStyle = `hsl(${i*2},100%,50%)`;
            ctx.fillRect(i*barWidth, canvas.height-h, barWidth-2, h);
        }
    }
    draw();
}
</script>
<script>
// =========================
//     PWA INSTALL LOGIC
// =========================
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

installBtn.style.display = "none"; // oculto por defecto

window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = "inline-block"; // mostrar bot√≥n neon
});

installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;

    if (outcome === "accepted") {
        console.log("User accepted install");
        installBtn.innerHTML = "‚úî INSTALADO";
        installBtn.style.background = "#00ffcc";
    }

    deferredPrompt = null;
});
</script>

</body>
</html>
