<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Música Variada GELM</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#00eaff">

<style>
/* ============================================================
   PALETA NEÓN
   ============================================================ */
:root{
  --azul: #00eaff;
  --rosa: #ff00d4;
  --morado: #7b00ff;
  --verde: #00ff99;
}

/* ============================================================
   FONDO NEÓN (OPCIÓN C)
   ============================================================ */
body{
  margin:0;
  font-family:Verdana;
  background: radial-gradient(circle at 20% 20%, #7b00ff, #000540 60%, #000010 100%);
  background-size:200% 200%;
  animation:fondomove 14s infinite alternate ease-in-out;
  text-align:center;
  color:white;
}

@keyframes fondomove{
  0%{background-position:0% 0%;}
  100%{background-position:100% 100%;}
}

/* ============================================================
   CONTENEDOR PRINCIPAL NEÓN
   ============================================================ */
.contenedor{
  width:90%;
  max-width:820px;
  margin:40px auto;
  padding:25px;
  border-radius:20px;
  background:rgba(5,5,20,0.55);
  box-shadow:
    0 0 15px var(--azul),
    inset 0 0 20px rgba(255,0,200,0.4),
    inset 0 0 28px rgba(0,255,255,0.4);
}

/* ============================================================
   TÍTULO + ÍCONOS NEÓN
   ============================================================ */
.header{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:30px;
  margin-bottom:20px;
}

.icon-neon{
  width:52px;
  height:52px;
  border-radius:50%;
  background: radial-gradient(circle, var(--azul), #004d66);
  color:#000;
  font-weight:bold;
  font-size:12px;
  display:flex;
  justify-content:center;
  align-items:center;
  box-shadow:0 0 20px var(--azul), inset 0 0 20px var(--azul);
}

.titulo{
  font-size:32px;
  font-weight:bold;
  letter-spacing:4px;
  background: linear-gradient(90deg, var(--rosa), var(--morado), var(--azul));
  -webkit-background-clip:text;
  color:transparent;
  text-shadow:0 0 15px var(--rosa);
}

/* ============================================================
   VISUALIZADOR
   ============================================================ */
#canvas{
  width:100%;
  height:200px;
  background:black;
  border-radius:20px;
  box-shadow:
    0 0 15px var(--rosa),
    inset 0 0 15px var(--azul);
  margin-bottom:18px;
}

/* ============================================================
   PLAYER BOX
   ============================================================ */
.player{
  padding:16px;
  background:#00000088;
  border-radius:18px;
  box-shadow:0 0 15px var(--azul);
  margin-bottom:25px;
}

/* Barra progreso */
.progress-container{
  width:90%;
  height:10px;
  background:#000;
  margin:0 auto 18px auto;
  border-radius:10px;
  box-shadow: inset 0 0 12px var(--morado);
}

.progress{
  width:0%;
  height:100%;
  border-radius:10px;
  background:var(--verde);
  box-shadow:0 0 12px var(--verde);
}

/* ============================================================
   BOTONES PLAYER
   ============================================================ */
.botones{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:18px;
}

.btn{
  padding:10px 18px;
  border:none;
  border-radius:14px;
  background: radial-gradient(circle, #0033ff, #002266);
  color:white;
  cursor:pointer;
  text-shadow:0 0 10px var(--azul);
  box-shadow:0 0 15px var(--azul);
  font-size:14px;
}

/* ============================================================
   BUSCADOR
   ============================================================ */
#buscar{
  width:75%;
  padding:12px;
  border-radius:12px;
  border:2px solid var(--azul);
  background:#0006;
  color:white;
  margin-bottom:22px;
  text-align:center;
  box-shadow:0 0 12px var(--azul);
}

/* ============================================================
   BENDICIDO DÍA = PLAY/PAUSE
   ============================================================ */
#bend{
  width:75%;
  margin:0 auto 25px auto;
  padding:18px;
  border-radius:18px;
  font-size:28px;
  letter-spacing:5px;
  text-shadow:0 0 12px var(--azul);
  background: radial-gradient(circle, #001a33, #003366);
  box-shadow:
    0 0 15px var(--azul),
    inset 0 0 20px rgba(0,255,255,0.6);
  cursor:pointer;
}

#bend.vibrar{
  animation:pulse 0.28s infinite alternate;
}

@keyframes pulse{
  0%{transform:scale(1); text-shadow:0 0 15px var(--azul);}
  100%{transform:scale(1.04); text-shadow:0 0 22px var(--azul);}
}

/* ============================================================
   BOTÓN INSTALAR PWA
   ============================================================ */
#btnInstall{
  display:none;
  margin:18px auto;
  padding:12px 30px;
  border:none;
  border-radius:16px;
  font-size:20px;
  cursor:pointer;
  background: radial-gradient(circle, var(--azul), #004d66);
  color:black;
  font-weight:bold;
  text-shadow:0 0 10px #00ffaa;
  box-shadow:
    0 0 20px var(--azul),
    0 0 30px #00ffaa,
    inset 0 0 20px #00ffff;
}

#btnInstall:hover{
  transform:scale(1.07);
}

</style>
</head>

<body>

<div class="contenedor">

  <div class="header">
    <div class="icon-neon">GELM</div>
    <div class="titulo">MÚSICA VARIADA</div>
    <div class="icon-neon">GELM</div>
  </div>

  <!-- BOTÓN INSTALAR PWA -->
  <button id="btnInstall">⚡ INSTALAR APP ⚡</button>

  <!-- VISUALIZADOR -->
  <canvas id="canvas"></canvas>

  <!-- PLAYER -->
  <div class="player">
    <audio id="audio"></audio>

    <div class="progress-container">
      <div id="progress" class="progress"></div>
    </div>

    <div class="botones">
      <button class="btn" id="prev">⏮ Anterior</button>
      <button class="btn" id="play">⏯</button>
      <button class="btn" id="next">Siguiente ⏭</button>
      <button class="btn" id="shuf">Shuffle: ON</button>
    </div>
  </div>

  <input id="buscar" placeholder="buscar canción…">

  <div id="bend">
    B E N D I C I D O <br>
    <span style="font-size:16px;"> D Í A </span>
  </div>

  <div style="font-size:12px;">
    2000 - 2040 | BIENVENIDOS | nerox2mil@proton.me <br>
    att: ---[terry]---
  </div>

</div>

<script>
/* ============================================================
   INSTALAR PWA
   ============================================================ */
let deferredPrompt;
const btnInstall = document.getElementById("btnInstall");

window.addEventListener("beforeinstallprompt", (e)=>{
    e.preventDefault();
    deferredPrompt = e;
    btnInstall.style.display = "inline-block";
});

btnInstall.onclick = async ()=>{
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    if(result.outcome === "accepted"){
        btnInstall.innerText = "✔ INSTALADA";
    }
    deferredPrompt = null;
};

/* ============================================================
   AUDIO + PLAYLIST DESDE JSON
   ============================================================ */
let audio = document.getElementById("audio");
let progress = document.getElementById("progress");
let buscar = document.getElementById("buscar");
let bend = document.getElementById("bend");

let canciones = [];
let idx = 0;
let shuffle = true;

/* Cargar JSON */
fetch("musica.json")
  .then(r => r.json())
  .then(d => { canciones = d; iniciar(); });

function iniciar(){
  if(shuffle) idx = Math.floor(Math.random()*canciones.length);
  cargar();
}

function cargar(){
  audio.src = canciones[idx].url;
  audio.play();
}

/* Botones */
play.onclick = ()=> audio.paused ? audio.play() : audio.pause();

prev.onclick = ()=>{ idx = (idx-1+canciones.length)%canciones.length; cargar(); };
next.onclick = ()=>{ idx = (idx+1)%canciones.length; cargar(); };

shuf.onclick = ()=>{
  shuffle = !shuffle;
  shuf.innerText = "Shuffle: "+(shuffle?"ON":"OFF");
};

/* BENDICIDO DÍA = PLAY/PAUSE */
bend.onclick = ()=> play.onclick();

audio.onplay = ()=> bend.classList.add("vibrar");
audio.onpause = ()=> bend.classList.remove("vibrar");

/* Barra progreso */
audio.ontimeupdate = ()=>{
  progress.style.width = (audio.currentTime / audio.duration)*100 + "%";
};

/* Buscador */
buscar.oninput = ()=>{
  let t = buscar.value.toLowerCase();
  let pos = canciones.findIndex(x => x.nombre.toLowerCase().includes(t));
  if(pos>=0){ idx = pos; cargar(); }
};

/* ============================================================
   VISUALIZADOR
   ============================================================ */
let ctx = new AudioContext();
let src = ctx.createMediaElementSource(audio);
let anal = ctx.createAnalyser();
src.connect(anal);
anal.connect(ctx.destination);

anal.fftSize = 256;
let buffer = new Uint8Array(anal.frequencyBinCount);

let canvas = document.getElementById("canvas");
let g = canvas.getContext("2d");

function draw(){
  requestAnimationFrame(draw);
  anal.getByteFrequencyData(buffer);

  g.clearRect(0,0,canvas.width,canvas.height);

  let w = canvas.width / buffer.length;
  for(let i=0;i<buffer.length;i++){
    let h = buffer[i];
    let x = w*i;
    let y = canvas.height - h;
    g.fillStyle = `hsl(${i*3},100%,50%)`;
    g.fillRect(x,y,w-1,h);
  }
}
draw();

canvas.width = canvas.offsetWidth;
canvas.height = canvas.offsetHeight;

/* ============================================================
   REGISTRO SERVICE WORKER
   ============================================================ */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
